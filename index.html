<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Test żeglarstwo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<script>
    var questionsList = [];
    var questionCategoryInfo = []
    var questionId = -1


    document.addEventListener("DOMContentLoaded", function () {
        fetch('all_questions.json')
            .then(response => response.json())
            .then(data => {
                questionsList = data.sort((a, b) => {
                    if (parseInt(a.test_id) < parseInt(b.test_id)) {
                        return -1;
                    }
                    if (parseInt(a.test_id) > parseInt(b.test_id)) {
                        return 1;
                    }

                    if (parseInt(a.subcategory) < parseInt(b.subcategory)) {
                        return -1;
                    }
                    if (parseInt(a.subcategory) > parseInt(b.subcategory)) {
                        return 1;
                    }
                    return 0;
                });

                var lastCategory = questionsList[0].category;
                var firstQuestion = 0;

                for (var i = 0; i < questionsList.length; i++) {
                    if (lastCategory !== questionsList[i].category || i === questionsList.length - 1) {
                        questionCategoryInfo.push({
                            'category': lastCategory,
                            'firstId': firstQuestion,
                            'numberQuestions': i - firstQuestion
                        });

                        firstQuestion = i;
                        lastCategory = questionsList[i].category;
                    }
                }
            });
    });

    function simpleShuffle(array) {
        return array.sort(() => Math.random() - 0.5);
    }

    function setQuestion() {
        questionText = questionsList[questionId].content;
        correctAnswer = questionsList[questionId].correct_answer;
        incorrectAnswer1 = questionsList[questionId].incorrect_answer_1;
        incorrectAnswer2 = questionsList[questionId].incorrect_answer_2;

        answersList = simpleShuffle([correctAnswer, incorrectAnswer1, incorrectAnswer2]);

        document.getElementById('question').innerText = questionText;

        const answersContainer = document.getElementById('answers');
        answersContainer.innerHTML = ''

        answersList.forEach(answer => {
            const button = document.createElement('button');
            button.className = 'answer';
            button.innerText = answer;
            button.setAttribute('onclick', 'checkAnswer(this)');
            button.setAttribute('is_correct_answer', (correctAnswer === answer));
            answersContainer.appendChild(button);
        });

        questionImg = questionsList[questionId].image
        var img = document.getElementById('question-img');

        if (!!questionImg) {
            img.src = questionImg;
            img.style.display = 'inline';
        } else {
            img.style.display = 'none';
        }

        categoryName = questionsList[questionId].category;
        var category = document.getElementById('category');
        category.innerText = categoryName;

        subCategoryName = questionsList[questionId].subcategory;
        var subcategory = document.getElementById('subcategory');
        subcategory.innerText = subCategoryName;

        var questionNumbers = 0;

        questionsList.forEach(question => {
            qCategory = question.category;

            if (qCategory === categoryName) {
                questionNumbers++;
            }
        });

        var currentQuestionId = 0;

        for (let i = 0; i <= questionId; i++) {
            if (questionsList[i].category === categoryName) {
                currentQuestionId++;
            }
        }

        var questionNumberDiv = document.getElementById('question-number');
        questionNumberDiv.innerText = '' + currentQuestionId + ' / ' + questionNumbers;
    }

    function nextQuestion() {
        if (questionId < questionsList.length - 1) {
            questionId++;
            setQuestion()
        }

        if (questionId > 0) {
            var previousButton = document.getElementById("previousButton");
            previousButton.hidden = false;
        }

        if (questionId === questionsList.length - 1) {
            var nextButton = document.getElementById("nextButton");
            nextButton.hidden = true;
        }
    }

    function previousQuestion() {
        if (questionId > 0) {
            questionId--;
            setQuestion()
        }

        if (questionId === 0) {
            var previousButton = document.getElementById("previousButton");
            previousButton.hidden = true;
        }

        if (questionId < questionsList.length - 1) {
            var nextButton = document.getElementById("nextButton");
            nextButton.hidden = false;
        }
    }


    function checkAnswer(clickedButton) {
        const answersContainer = document.getElementById('answers');

        var buttons = answersContainer.querySelectorAll("button");

        buttons.forEach(function (button) {
            if (button.getAttribute('is_correct_answer') === 'true') {
                button.className = 'answer-correct';
            } else {
                button.className = 'answer-incorrect';
            }

            button.setAttribute('onclick', '');
        });

        if (clickedButton.getAttribute('is_correct_answer') === 'true') {
            clickedButton.className = 'answer-selected-correct';
        } else {
            clickedButton.className = 'answer-selected-incorrect';
        }
    }

    function startTest() {
        var menuDiv = document.getElementById("menu");
        menuDiv.style.display = 'none';

        var testDiv = document.getElementById("test");
        testDiv.style.display = '';

        var previousButton = document.getElementById("previousButton");
        previousButton.hidden = true;

        nextQuestion();
    }

    function returnToMenu() {
        var menuDiv = document.getElementById("menu");
        menuDiv.style.display = '';

        var testDiv = document.getElementById("test");
        testDiv.style.display = 'none';
    }

</script>

<div id="menu" class="container">
    <button onclick="startTest()">Rozpocznij test</button>
</div>

<div id="test" class="container" style="display: none">
    <div id="information" style="display: grid">
        <div style="display: inline">
            <div style="float: left"><b>Kategoria:</b></div>
            <div id="category" style="float: right"></div>
        </div>
        <div style="display: inline">
            <div style="float: left"><b>Podkategoria:</b></div>
            <div id="subcategory" style="float: right"></div>
        </div>
        <div style="display: inline">
            <div style="float: left"><b>Numer:</b></div>
            <div id="question-number" style="float: right"></div>
        </div>
    </div>
    <h1 id="question"></h1>
    <img id="question-img"/>
    <div id="answers"></div>

    <div style="margin-top: 50px; display: grid">
        <div class="navigation-buttons">
            <button id="previousButton" style="float: left" onclick="previousQuestion()">< Poprzednie pytanie</button>
            <button id="nextButton" style="float: right" onclick="nextQuestion()">Nastepne pytanie ></button>
        </div>
        <div class="navigation-buttons">
            <button id="previousCategory" style="float: left" onclick="previousCategory()"><< Poprzednie kategoria
            </button>
            <button id="nextCategory" style="float: right" onclick="nextCategory()">Nastepne kategoria ></button>
        </div>
        <div class="navigation-buttons">
            <button id="returnToMenu" onclick="returnToMenu()">Powrót do menu</button>
        </div>
    </div>
</div>
</body>
</html>

